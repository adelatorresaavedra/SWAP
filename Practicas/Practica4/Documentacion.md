Práctica 4 :**Instalar un certificado SSL autofirmado para configurar el acceso por HTTPS**Lo primero para generar el certificado SSL, vamos a reiniciar el servicio de apache. **sudo bash** y luego **service apache2 restart.****(imagen1)**Ahora para generar un certificado SSL autofirmado en Ubuntu Server solo debemos activar el módulo SSL de Apache, generar los certificados y especificarle la ruta a los certificados en la configuración. Para ello seguiremos estos pasos**a2enmod ssl****service apache2 restart****mkdir /etc/apache2/ssl****openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/apache2/ssl/apache.key- -out /etc/apache2/ssl/apache.crt****(imagen2)**Nos pedirá una serie de datos para configurar el dominio.**(imagen3)**Editamos el archivo de configuración del sitio default-ssl:**nano /etc/apache2/sites-available/default-ssl**Y agregamos estas lineas debajo de donde pone SSLEngine on**SSLCertificateFile /etc/apache2/ssl/apache.crt****SSLCertificateKeyFile /etc/apache2/ssl/apache.key****(Imagen 4)**Activamos el sitio default--ssl y reiniciamos apache:**a2ensite default-ssl****service apache2 reload****CONFIGURACIÓN DE CORTAFUEGOS:**A continuación se mostrará cómo utilizar la herramienta para establecer ciertas reglas y filtrar algunos tipos de tráfico, o bien controlar el acceso a ciertas páginas: Toda a información sobre la herramienta está disponible en su página de manual y usando la opción de ayuda.**man iptables****iptables –h**Para comprobar el estado del cortafuegos, debemos ejecutar:**iptables –L –n -v**Lo habitual es crear un script que se ejecute en el arranque del sistema. Veamos a continuación un ejemplo de script para la configuración básica de una máquina Linux:\*Lo hacemos todo en modo root para tener todos los permisos.(1) Se eliminan todas las reglas que hubiera para hacer la configuración limpia:**iptables -F****iptables -X****iptables -Z**** iptables -t nat -F**(2) Establecer las políticas por defecto (denegar todo el tráfico):**iptables -P INPUT DROP****iptables -P OUTPUT DROP****iptables -P FORWARD DROP**(3) Permitir cualquier acceso desde localhost (interface lo):**iptables -A INPUT -i lo -j ACCEPT****iptables -A OUTPUT -o lo -j ACCEPT**(4) Abrir el puerto 22 para permitir el acceso por SSH:**iptables -A INPUT -p tcp --dport 22 -j ACCEPT****iptables -A OUTPUT -p tcp --sport 22 -j ACCEPT**(5) Abrir los puertos HTTP/HTTPS (80 y 443) de servidor web:**iptables -A INPUT -p tcp --dport 80 -j ACCEPT****iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT****(imagen 6)**Por último, conviene comprobar el funcionamiento del cortafuegos recién configurado. Para ello, pediremos al sistema que nos muestre qué puertos hay abiertos y qué demonios o aplicaciones los tienen en uso. Para ello, utilizaremos la orden netstat como se muestra a continuación:**netstat -tulpn**Por ejemplo, para asegurarnos del estado (abierto/cerrado) del puerto 80, podemos ejecutar:**netstat -tulpn | grep :80****(imagen 7)**